<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.1.6 <https://hydejack.com/>
-->







<head>
  






  
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ECR - Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기 | Chiptune93</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="ECR - Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기" />
<meta name="author" content="Donkyu Lim" />
<meta property="og:locale" content="en_us,ko_KR" />
<meta name="description" content="[ECR] Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기" />
<meta property="og:description" content="[ECR] Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기" />
<link rel="canonical" href="http://localhost:4000/aws/jib-ecr-upload/" />
<meta property="og:url" content="http://localhost:4000/aws/jib-ecr-upload/" />
<meta property="og:site_name" content="Chiptune93" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-23T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ECR - Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기" />
<meta name="google-site-verification" content="h-Kcf1JEo-TX6AcTLtmYiZbGGjnTnIfbgrEukp8n8r0" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Donkyu Lim"},"dateModified":"2022-03-23T00:00:00+09:00","datePublished":"2022-03-23T00:00:00+09:00","description":"[ECR] Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기","headline":"ECR - Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/aws/jib-ecr-upload/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logo.png"},"name":"Donkyu Lim"},"url":"http://localhost:4000/aws/jib-ecr-upload/"}</script>
<!-- End Jekyll SEO tag -->


  

  
    <meta name="keywords" content="tech,developer,java,spring,docker,mysql,oracle,error,linux,server,backend">
  



  <meta name="theme-color" content="rgb(25,55,71)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Chiptune93">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="Chiptune93">

<meta name="generator" content="Hydejack v9.1.6" />


<link rel="alternate" href="http://localhost:4000/aws/jib-ecr-upload/" hreflang="en-us,ko-kr">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chiptune93" />


<link rel="shortcut icon"    href="/assets/img/favicon.ico">
<link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">

<link rel="manifest" href="/assets/site.webmanifest">

<link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com">



<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">






<script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2022-11-30T01:32:05+09:00',
  };
  w._clapButton = true;
}(window);</script>


<script async src="/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script>


<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+KR:wght@200%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload">



  <style id="_pageStyle">

html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79,177,186,0.5);--accent-color-highlight: rgba(79,177,186,0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(25,55,71)}

</style>


<!--<![endif]-->


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N6KPDZJCZT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N6KPDZJCZT');
</script>

</head>

<body class="no-break-layout">
  


<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/aws/">aws</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>jib-ecr-upload</span>
        
      </li>
    
  
</ul></nav>
  










<article id="post-aws-jib-ecr-upload" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        ECR - Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2022-03-23T00:00:00+09:00">23 Mar 2022</time> in <a href="/aws/" class="flip-title">AWS</a> on <span>Aws</span>, <span>Ecr</span>, <span>Jib</span>, <span>Ecr upload</span>
      </span>
      
    </div>

    
    

    



  
    <p class="note-sm" >
      [ECR] Spring Boot + JSP 프로젝트 JIB로 ECR 업로드하기

    </p>
  


  </header>

  
    <ul class="large-only" id="markdown-toc">
  <li><a href="#jar-vs-war" id="markdown-toc-jar-vs-war">JAR vs WAR</a></li>
  <li><a href="#jib" id="markdown-toc-jib">Jib</a></li>
  <li><a href="#jib-jar--jib-war" id="markdown-toc-jib-jar--jib-war">Jib JAR / Jib WAR</a></li>
  <li><a href="#jib-배포-코드-작성" id="markdown-toc-jib-배포-코드-작성">JIB 배포 코드 작성</a></li>
</ul>

<p>기존 작업은 보통 RESTful API 형태로 구성이 된 서비스를 주로 jib로 올렸었지만, 기존 MPA 서비스와 동일한 Spring Boot 프로젝트를 ECR에 업로드해야할 일이 생겼다.</p>

<p>기존 프로젝트의 경우, 백단 요청만 받아서 처리하면 되기에 JAR파일로 묶어 Jib를 통해 ECR에 배포되는 형태를 가졌으나 이번에는 웹 리소스까지 포함된 전체 프로젝트를 배포하여 운영해야 하는 상황이었다.</p>

<h2 id="jar-vs-war">JAR vs WAR</h2>

<p><img src="/assets/img/AWS/jibecr1.jpeg" alt="jibEcr1" /></p>

<ul>
  <li>JAR : Java 클래스, 메타데이터 등으로 구성된 자바 어플리케이션을 구동하기 위한 파일</li>
  <li>WAR : JAR 구성 파일을 포함하여 서블릿이나 JSP등 웹 애플리케이션을 배포 및 테스트 하기 위한 파일들로 구성된 파일</li>
</ul>

<p>주요 차이점은, 해당 파일들을 구성하는 내용 측면에 존재한다는 것. 어찌됐건 애플리케이션을 만들어 배포할 수 있다는 점에서는 큰 맥락을 같이 한다.</p>

<p>따라서, 본인이 만든 웹 애플리케이션을 어떤 구성으로 배포를 할 것인지는 선택의 문제다.</p>

<p>참고 : https://pediaa.com/what-is-the-difference-between-jar-and-war-files/</p>

<h2 id="jib">Jib</h2>

<p>도커 데몬 없이 빌드 이미지를 빠르게 구성하여 원하는 레파지토리/레지스트리로 Push가 가능한 툴</p>

<p>https://github.com/GoogleContainerTools/jib/blob/master/jib-gradle-plugin/README.md#extradirectories-object</p>

<h2 id="jib-jar--jib-war">Jib JAR / Jib WAR</h2>

<p>Jib 를 통해 ECR에 푸시하기로 하고, 이를 위해 jib를 세팅하였다.</p>

<p>기존에 작성해놓았던 jib 를 어느정도 참고하고 JAR배포와 WAR배포 차이에 따라 적절히 옵션을 나누어 사용했다.</p>

<p>참고 - maven 사용 시</p>

<p>https://github.com/GoogleContainerTools/jib/blob/master/jib-maven-plugin/README.md#extradirectories-object</p>

<p>참고 - gradle 사용 시</p>

<p>https://github.com/GoogleContainerTools/jib/blob/master/jib-maven-plugin/README.md#extradirectories-object</p>

<h2 id="jib-배포-코드-작성">JIB 배포 코드 작성</h2>

<p>우선, AWS에 개발/데모/운영 3개의 환경으로 나뉘어있어 프로파일 적용을 하였고 이미지 태그를 현재 날짜로 주어 최소한의 구분이 가능토록 하였다. AWS CI/CD에서는 배포된 이미지에 큰 변경이 없으면 새로 빌드하여 배포하지 않기 때문에 최소한의 버전 구분이 필요하다</p>

<ul>
  <li>Spring Boot Jar 배포</li>
</ul>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// command_line 에서 -Dname=Value 로 넘어오는데 -D 는 System property 의미. 따라서, System.getProperty 로 가져온다.</span>

<span class="c1">// 프로젝트 네임 설정</span>
<span class="kt">def</span> <span class="n">project</span> <span class="o">=</span> <span class="s2">"project_name"</span>

<span class="c1">// 프로젝트 메이저 버전명</span>
<span class="kt">def</span> <span class="n">major_version</span> <span class="o">=</span> <span class="s2">"0.1"</span>

<span class="c1">// 현재시각</span>
<span class="kt">def</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s1">'yyyyMMddHHmm'</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">jib</span> <span class="o">{</span>
	<span class="c1">// profile, image_name 변수 설정</span>
	<span class="kt">def</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s1">'profile'</span><span class="o">)</span>
	<span class="kt">def</span> <span class="n">image_name</span>

	<span class="c1">// profile 에 따른 image 설정</span>
	<span class="c1">// dev 		: 개발서버</span>
	<span class="c1">// demo 	: 데모서버</span>
	<span class="c1">// live 	: 운영서버</span>
	<span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'dev'</span> <span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 개발 세팅</span>
		<span class="n">image_name</span> <span class="o">=</span> <span class="s2">"{ecr url}/"</span> <span class="o">+</span> <span class="n">project</span>
	<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'demo'</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 데모 세팅</span>
		<span class="n">image_name</span> <span class="o">=</span> <span class="s2">"{ecr url}/"</span> <span class="o">+</span> <span class="n">project</span>
	<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'live'</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 라이브 세팅</span>
		<span class="n">image_name</span> <span class="o">=</span> <span class="s2">"{ecr url}/"</span> <span class="o">+</span> <span class="n">project</span>
	<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
		<span class="c1">// exception</span>
	<span class="o">}</span>

	<span class="n">from</span> <span class="o">{</span>
		<span class="n">image</span> <span class="o">=</span> <span class="s2">"adoptopenjdk/openjdk8:alpine-jre"</span>
	<span class="o">}</span>
	<span class="n">to</span> <span class="o">{</span>
		<span class="n">image</span> <span class="o">=</span> <span class="n">image_name</span>
		<span class="n">tags</span>  <span class="o">=</span> <span class="o">[</span><span class="n">major_version</span> <span class="o">+</span><span class="s1">'.'</span> <span class="o">+</span> <span class="n">getDate</span><span class="o">()]</span>
	<span class="o">}</span>
	<span class="n">container</span> <span class="o">{</span>
		<span class="c1">// Set JVM options.</span>
		<span class="n">jvmFlags</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'-Dspring.profiles.active='</span> <span class="o">+</span> <span class="n">profile</span><span class="o">,</span> <span class="s1">'-XX:+UseContainerSupport'</span><span class="o">,</span> <span class="s1">'-Dserver.port=8080'</span><span class="o">,</span> <span class="s1">'-Dfile.encoding=UTF-8'</span><span class="o">]</span>
		<span class="c1">// Expose different port.</span>
		<span class="n">ports</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'8080'</span><span class="o">]</span>
	<span class="o">}</span>
	<span class="n">println</span> <span class="s2">"#########################################################"</span>
	<span class="n">println</span> <span class="s2">"profile : "</span> <span class="o">+</span> <span class="n">profile</span>
	<span class="n">println</span> <span class="s2">"image name : "</span> <span class="o">+</span> <span class="n">image_name</span>
	<span class="n">println</span> <span class="s2">"tag : "</span> <span class="o">+</span> <span class="n">major_version</span> <span class="o">+</span> <span class="s2">"."</span> <span class="o">+</span> <span class="n">getDate</span><span class="o">()</span>
	<span class="n">println</span> <span class="s2">"#########################################################"</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>위 Jar 코드 기반 WAR jib 배포 코드</li>
</ul>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 프로젝트 네임 설정</span>
<span class="kt">def</span> <span class="n">project</span> <span class="o">=</span> <span class="s2">"project_name"</span>

<span class="c1">// 프로젝트 메이저 버전명</span>
<span class="kt">def</span> <span class="n">major_version</span> <span class="o">=</span> <span class="s2">"0.1"</span>

<span class="c1">// 현재시각</span>
<span class="kt">def</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s1">'yyyyMMddHHmm'</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">jib</span> <span class="o">{</span>

    <span class="c1">// profile, image_name 변수 설정</span>
    <span class="kt">def</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s1">'profile'</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">"dev"</span> <span class="o">:</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s1">'profile'</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">image_name</span>

    <span class="c1">// profile 에 따른 image 설정</span>
    <span class="c1">// dev      : 개발서버</span>
    <span class="c1">// demo     : 데모서버</span>
    <span class="c1">// live     : 운영서버</span>

    <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'dev'</span> <span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 개발 세팅</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="s2">"{ecr url}/"</span> <span class="o">+</span> <span class="n">project</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'demo'</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 데모 세팅</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="s2">"{ecr url}/"</span> <span class="o">+</span> <span class="n">project</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'live'</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 라이브 세팅</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="s2">"{ecr url}/"</span> <span class="o">+</span> <span class="n">project</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// exception</span>
    <span class="o">}</span>

	<span class="c1">// 빌드 파일 추가 옵션</span>
	<span class="n">extraDirectories</span><span class="o">.</span><span class="na">paths</span> <span class="o">=</span> <span class="s2">"build/libs"</span>

	<span class="n">from</span> <span class="o">{</span>
		<span class="n">image</span> <span class="o">=</span> <span class="s2">"adoptopenjdk/openjdk8:alpine-jre"</span>
	<span class="o">}</span>
	<span class="n">to</span> <span class="o">{</span>
		<span class="n">image</span> <span class="o">=</span> <span class="n">image_name</span>
		<span class="n">tags</span>  <span class="o">=</span> <span class="o">[</span><span class="n">major_version</span> <span class="o">+</span><span class="s1">'.'</span> <span class="o">+</span> <span class="n">getDate</span><span class="o">()]</span>
	<span class="o">}</span>
	<span class="n">container</span> <span class="o">{</span>
        <span class="c1">// Set JVM options.</span>
        <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'dev'</span> <span class="o">)</span> <span class="o">{</span>
			<span class="n">entrypoint</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'java'</span><span class="o">,</span><span class="s1">'-Dspring.profiles.active='</span> <span class="o">+</span> <span class="n">profile</span><span class="o">,</span> <span class="s1">'-XX:+UseContainerSupport'</span><span class="o">,</span> <span class="s1">'-Dserver.port=8080'</span><span class="o">,</span> <span class="s1">'-Dfile.encoding=UTF-8'</span><span class="o">,</span> <span class="s1">'-Xms512m'</span><span class="o">,</span> <span class="s1">'-Xmx1024m'</span><span class="o">,</span> <span class="s1">'-jar'</span><span class="o">,</span><span class="s1">'/acaas-admin.war'</span><span class="o">,</span><span class="s1">''</span><span class="o">]</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'demo'</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">entrypoint</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'java'</span><span class="o">,</span><span class="s1">'-Dspring.profiles.active='</span> <span class="o">+</span> <span class="n">profile</span><span class="o">,</span> <span class="s1">'-XX:+UseContainerSupport'</span><span class="o">,</span> <span class="s1">'-Dserver.port=8080'</span><span class="o">,</span> <span class="s1">'-Dfile.encoding=UTF-8'</span><span class="o">,</span> <span class="s1">'-Xms512m'</span><span class="o">,</span> <span class="s1">'-Xmx1024m'</span><span class="o">,</span> <span class="s1">'-jar'</span><span class="o">,</span><span class="s1">'/acaas-admin.war'</span><span class="o">,</span><span class="s1">''</span><span class="o">]</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span> <span class="n">profile</span> <span class="o">==</span> <span class="s1">'live'</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">entrypoint</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'java'</span><span class="o">,</span><span class="s1">'-Dspring.profiles.active='</span> <span class="o">+</span> <span class="n">profile</span><span class="o">,</span> <span class="s1">'-XX:+UseContainerSupport'</span><span class="o">,</span> <span class="s1">'-Dserver.port=8080'</span><span class="o">,</span> <span class="s1">'-Dfile.encoding=UTF-8'</span><span class="o">,</span> <span class="s1">'-jar'</span><span class="o">,</span><span class="s1">'/acaas-admin.war'</span><span class="o">,</span><span class="s1">''</span><span class="o">]</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="o">}</span>
        <span class="c1">// Expose different port.</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'8080'</span><span class="o">]</span>
    <span class="o">}</span>

    <span class="n">println</span> <span class="s2">"#########################################################"</span>
    <span class="n">println</span> <span class="s2">"profile : "</span> <span class="o">+</span> <span class="n">profile</span>
    <span class="n">println</span> <span class="s2">"image name : "</span> <span class="o">+</span> <span class="n">image_name</span>
    <span class="n">println</span> <span class="s2">"tag : "</span> <span class="o">+</span> <span class="n">major_version</span> <span class="o">+</span> <span class="s2">"."</span> <span class="o">+</span> <span class="n">getDate</span><span class="o">()</span>
    <span class="n">println</span> <span class="s2">"#########################################################"</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Jib Github 에도 언급된 내용인데 기본적로 JIB는 JAR 형식의 배포가 기본이고 WAR 프로젝트에 대해서는 조금 다른 옵셔닝을 해주어야 한다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Jib also containerizes WAR projects. If the Gradle project uses the WAR Plugin, Jib will by default use jetty as a base image to deploy the project WAR. No extra configuration is necessary other than using the WAR Plugin to make Jib build WAR images.

Note that Jib will work slightly differently for WAR projects from JAR projects:

container.mainClass and container.jvmFlags are ignored.
The WAR will be exploded into /var/lib/jetty/webapps/ROOT, which is the expected WAR location for the Jetty base image.
To use a different Servlet engine base image, you can customize container.appRoot, container.entrypoint, and container.args. If you do not set entrypoint or args, Jib will inherit the ENTRYPOINT and CMD of the base image, so in many cases, you may not need to configure them. However, you will most likely have to set container.appRoot to a proper location depending on the base image. Here is an example of using a Tomcat image:
</code></pre></div></div>

<p>https://github.com/GoogleContainerTools/jib/blob/master/jib-gradle-plugin/README.md#war-projects</p>

<p>위 설명을 보면, WAR 프로젝트 배포시에는 container.mainClass, container.jvmFlags 옵션은 무시되며, 기본 웹 앱 경로가 fix 된다. 그리고 Entrypoint 나 cmd 옵션이 정의되지 않는다면 이 또한 적용되지 않는다.</p>

<p>따라서 WAR 배포시에는 베이스 이미지를 JDK로 잡을 것이라면, Dockerfile로 애플리케이션을 기본 배포하는 것 처럼</p>

<ol>
  <li>
    <p>WAR 파일을 베이스 이미지에 포함시키고</p>
  </li>
  <li>
    <p>해당 파일을 java -jar를 통해 실행시키는</p>
  </li>
</ol>

<p>방법을 취해야 한다. 위 JIB 코드를 보면 해당 내용들 또한 추가가 되어있는 것을 볼 수 있다.</p>

<p>보통 검색해보면, WAR 프로젝트의 경우 리소스 크기가 크고, 이를 서버에 올렸을 경우에는 CPU 이용률이 높아지는 등의 문제가 있으니 JAR 형식을 사용하라고 권고하고 있다. 하지만 WAR 또한 애플리케이션을 배포하는 방법 중의 하나이고 기존의 배포 툴에서 지원하지 않는 것도 아니다.</p>

<p>다만, 현재 운영하고자 하는 환경에 있어 WAR 프로젝트의 리소스 크기나 사용률에 문제가 없다면 해당 방식으로 배포하는 것도 결코 나쁘지 않은 선택이라고 할 수 있다고 본다.</p>

  
</article>



  <hr class="dingbat related mb6" />






  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    


<img
  
    src="/assets/img/logo.png"
    srcset="/assets/img/logo.png 1x,/assets/img/logo.png 2x"
    
  
  alt="Donkyu Lim"
  class="avatar"
  
  width="120"
  height="120"
  loading="lazy"
/>

  

  
  
  <h2  class="page-title hr-bottom">
    About
  </h2>

  <p>2018년 IPP 일학습병행제로 개발을 시작해, 현재까지 웹 백엔드 개발자로 일하고 있습니다.
<br /> 다른 개발자를 위한 내부 서비스 개발 및 문서화 공유에 신경을 많이 쓰는 편입니다.
<br /> 새로운 일을 찾아 나서는 것을 좋아합니다.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/Chiptune93" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:eoen012@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
  

  
    


  <aside class="related mb4" role="complementary">  <h2 class="hr-bottom">Related Posts</h2>  <ul class="related-posts">                  <li class="h4">  <a href="/git/git-pull-request/" class="flip-title"><span>Git - Pull Request(PR)</span></a>  <time class="faded fine" datetime="2022-11-24T00:00:00+09:00">24 Nov 2022</time></li>                        <li class="h4">  <a href="/python/discord-bot-message/" class="flip-title"><span>Python - Discord 채널에 메세지 전달하기</span></a>  <time class="faded fine" datetime="2022-09-19T00:00:00+09:00">19 Sep 2022</time></li>                        <li class="h4">  <a href="/aws/aws-lambda-call/" class="flip-title"><span>AWS Lambda - Lambda 내부에서 다른 람다 함수 호출하기</span></a>  <time class="faded fine" datetime="2022-09-13T00:00:00+09:00">13 Sep 2022</time></li>            </ul></aside>

  

  
  

  
    

  


  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">© 2021. All rights reserved.
</small></p>
  
  
    <nav class="legal"><small>
    
      
      <a class="heading flip-title" href="/LICENSE/">LICENSE</a>
      |
    
      
      <a class="heading flip-title" href="/NOTICE/">NOTICE</a>
      |
    
      
      <a class="heading flip-title" href="/CHANGELOG/">CHANGELOG</a>
      
    
    </small></nav>
  
    <p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.1.6</span></small></p>
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar-bg.png)"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/img/logo.png" class="avatar" alt="Chiptune93" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">Chiptune93</h2></a>
    
    
      <p class="">
        Per Ardua Ad Astra. Lucete Stellae.

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/java/"
          class="sidebar-nav-item "
          
        >
          🚀 Java
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/spring/"
          class="sidebar-nav-item "
          
        >
          🔮 Spring
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/database/"
          class="sidebar-nav-item "
          
        >
          📋 Database
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/server/"
          class="sidebar-nav-item "
          
        >
          💻 Server
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/frontend/"
          class="sidebar-nav-item "
          
        >
          🎆 Frontend
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/git/"
          class="sidebar-nav-item "
          
        >
          🧬 Git
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/aws/"
          class="sidebar-nav-item "
          
        >
          🎃 AWS
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/docker/"
          class="sidebar-nav-item "
          
        >
          🔌 Docker
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/network/"
          class="sidebar-nav-item "
          
        >
          📧 Network
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/python/"
          class="sidebar-nav-item "
          
        >
          ✨ Python
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/ide/"
          class="sidebar-nav-item "
          
        >
          💎 IDE
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/error/"
          class="sidebar-nav-item "
          
        >
          🔥 Error
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/etc/"
          class="sidebar-nav-item "
          
        >
          👑 Etc
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/project/"
          class="sidebar-nav-item "
          
        >
          🧭 Project
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/Chiptune93" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:eoen012@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}();
</script>
  <script src="/assets/js/hydejack-9.1.6.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script>
  

  

<!--<![endif]-->
  <!-- <script>
  document.querySelector('hy-push-state').setAttribute('prefetch', '');

  document.querySelectorAll('.sidebar a[href^="/"]').forEach(function (el) { 
    el.addEventListener('click', function (e) {
      if (el.pathname === window.location.pathname) {
        e.preventDefault();
        e.stopPropagation();
        document.querySelector('hy-drawer').close();
      }
    });
  });
</script> -->

<!--
Code for integrating CloudFlare's email protection with Hydejack's single page app loading.
-->
<script>
  document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) {
    function e(e){
      (console.error?console.error:console.log).call(console,e)
    }

    function t(e){
      return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href")
    }

    function r(e,t){
      var r=e.substr(t,2);return parseInt(r,16)
    }

    function n(e,n){
      for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){
        var l=r(e,a)^c;
        o+=String.fromCharCode(l)
      }
      return t(o)
    }

    var o="/cdn-cgi/l/email-protection#",
        c=".__cf_email__",
        a="data-cfemail",
        l=document.createElement("div");

    !function(){
      for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++)
        try{
          var c=t[r],a=c.href.indexOf(o);
          a>-1&&(c.href="mailto:"+n(c.href,a+o.length))
        }catch(t){
          e(t)
        }
    }(),
    function(){
      for(var t=document.querySelectorAll(c),r=0;r<t.length;r++)
        try{
          var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l);
          o.parentNode.replaceChild(i,o)
        }catch(t){
          e(t)
        }
    }()
  });
</script>



<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9929861974308715"
     crossorigin="anonymous"></script>


<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

</div>


</body>
</html>
